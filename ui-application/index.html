<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<meta name="description" content="description">
<title>Todo List</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container" >
    <h2>Todo List</h2>

    <div>
      <div class="formInputArea">
        <input id="inputText" class="inputText" type="text" placeholder="What needs to be done?" autofocus="">
      </div>
      <ul id="todoList" class = "todoList">
      </ul>
    </div>
  </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"/>
<script>
  var todos = [];
  var baseurl = "http://localhost:8080"
  $(document).ready(function () {
    $(document).on('mouseenter', '.items', function () {
      $(this).find(":button").show();
    }).on('mouseleave', '.items', function () {
      $(this).find(":button").hide();
    });
  });

  $('#inputText').keydown(function(e) {
    var item = $('#inputText').val();
    if (e.which == 13 && item.length > 0) {
      $('#inputText').val('')
      $.ajax({
        method: "POST",
        url: baseurl + "/todoitems",
        contentType: "application/json",
        data: JSON.stringify({todo: item})
      })
      .done(function(data) {
        loadItems()
      });
    }
  });
  function loadItems() {
    $.get(baseurl + "/todoitems")
      .done(function(data) {
        if(data.length > 0) {
          todos = []
          for (var i=0; i<data.length; i++) {
            todos.push(data[i])
          }
          refreshList()
        }
      });
  }
  loadItems()

  function refreshList() {
    $('#todoList').empty();
    for (var i=0; i<todos.length; i++) {
      $('#todoList').append("<li class=\"items\"><input class=\"toggle\" type=\"checkbox\">"
      + todos[i].todo
      + "<button class=\"button\" onclick=\"deleteItem("
      + i
      + ")\">X</button></li>")
    }
  }

  function deleteItem(index) {
    var id = todos[index]._id
    $.ajax({
      method: "DELETE",
      url: baseurl + "/todoitem/" + id,
      contentType: "application/json"
    })
    todos.splice(index, 1)
    refreshList()
  }
  </script>
</body>
</html>
